<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up - V-Connect</title>
  <link rel="icon" href="../assets/v1.png" type="image/png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/signup.css">
</head>

<body>
  <nav class="navbar navbar-expand-lg fixed-top">
    <div class="container">
      <a class="navbar-brand" href="index.html">
        <img src="../assets/v1.png" alt="V-Connect Logo" height="40">
        V-Connect
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="opportunity.html">
              <i class="fas fa-search"></i> Opportunities
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="about.html">
              <i class="fas fa-info-circle"></i> About
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="blog.html">
              <i class="fas fa-blog"></i> Blog
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link btn btn-primary ms-2" href="signup.html">
              <i class="fas fa-user"></i> Login
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <div class="auth-container">
      <div class="auth-left">
        <h1>Welcome to V-Connect</h1>
        <p>Join our community of volunteers and make a real difference in the world</p>
        <ul class="auth-features">
          <li><i class="fas fa-hands-helping"></i> Connect with meaningful volunteer opportunities</li>
          <li><i class="fas fa-users"></i> Join a community of passionate volunteers</li>
          <li><i class="fas fa-certificate"></i> Earn certificates and recognition</li>
          <li><i class="fas fa-chart-line"></i> Track your volunteer journey</li>
        </ul>
      </div>

      <div class="auth-right">
        <div id="auth-forms">
          <!-- Signup Form -->
          <form id="signup-form" class="auth-form" style="display: none;">
            <h2 class="mb-4">Create Account</h2>
            <div class="social-login">
              <button type="button" class="social-btn" id="google-signup">
                <img src="https://www.google.com/favicon.ico" alt="Google" width="20" height="20">
                Google
              </button>
              <button type="button" class="social-btn" id="facebook-signup">
                <i class="fab fa-facebook-f"></i>
                Facebook
              </button>
            </div>
            <div class="divider">
              <span>or register with email</span>
            </div>
            <div class="form-group">
              <label class="form-label" for="name">Full Name</label>
              <input type="text" class="form-control" id="name" placeholder="Enter your full name" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="email">Email Address</label>
              <input type="email" class="form-control" id="email" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="password">Password</label>
              <input type="password" class="form-control" id="password" placeholder="Create a password" required>
              <button type="button" class="toggle-password" aria-label="Toggle password visibility"
                title="Toggle password visibility">
                <i class="fas fa-eye" aria-hidden="true"></i>
              </button>
              <div class="password-requirements">
                <div class="requirement-item" data-requirement="length">
                  <i class="fas fa-circle"></i> At least 8 characters
                </div>
                <div class="requirement-item" data-requirement="uppercase">
                  <i class="fas fa-circle"></i> One uppercase letter
                </div>
                <div class="requirement-item" data-requirement="lowercase">
                  <i class="fas fa-circle"></i> One lowercase letter
                </div>
                <div class="requirement-item" data-requirement="number">
                  <i class="fas fa-circle"></i> One number
                </div>
                <div class="requirement-item" data-requirement="special">
                  <i class="fas fa-circle"></i> One special character
                </div>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" for="userType">I want to</label>
              <select class="form-control" id="userType" required>
                <option value="" disabled selected>Select your role</option>
                <option value="volunteer">Volunteer for Events</option>
                <option value="organizer">Organize Events</option>
              </select>
            </div>
            <button type="submit" class="btn btn-auth">
              <i class="fas fa-user-plus me-2"></i> Create Account
            </button>
            <p class="text-center mt-4">
              Already have an account?
              <a href="#" id="toggle-form" class="text-decoration-none text-primary">Sign in</a>
            </p>
          </form>
          <!-- Login Form -->
          <form id="login-form" class="auth-form">
            <h2 class="mb-4">Welcome Back</h2>
            <div class="social-login">
              <button type="button" class="social-btn" id="google-login">
                <img src="https://www.google.com/favicon.ico" alt="Google" width="20" height="20">
                Google
              </button>
              <button type="button" class="social-btn" id="facebook-login">
                <i class="fab fa-facebook-f"></i>
                Facebook
              </button>
            </div>
            <div class="divider">
              <span>or sign in with email</span>
            </div>
            <div class="form-group">
              <label class="form-label" for="login-email">Email Address</label>
              <input type="email" class="form-control" id="login-email" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="login-password">Password</label>
              <input type="password" class="form-control" id="login-password" placeholder="Enter your password"
                required>
              <button type="button" class="toggle-password" aria-label="Toggle password visibility"
                title="Toggle password visibility">
                <i class="fas fa-eye" aria-hidden="true"></i>
              </button>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-4">
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="remember-me">
                <label class="form-check-label" for="remember-me">Remember me</label>
              </div>
              <a href="#" id="forgot-password" class="text-decoration-none">Forgot Password?</a>
            </div>
            <button type="submit" class="btn btn-auth">
              <i class="fas fa-sign-in-alt me-2"></i> Sign In
            </button>
            <p class="text-center mt-4">
              Don't have an account?
              <a href="#" id="toggle-to-signup" class="text-decoration-none text-primary">Sign up</a>
            </p>
          </form>
        </div>
      </div>
    </div>
  </div>
  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5>About V-Connect</h5>
          <p>Connecting volunteers with meaningful opportunities to create positive change in communities.</p>
        </div>
        <div class="col-md-4">
          <h5>Quick Links</h5>
          <ul class="list-unstyled">
            <li><a href="about.html">About Us</a></li>
            <li><a href="opportunity.html">Opportunities</a></li>
            <li><a href="blog.html">Blog</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div>
        <div class="col-md-4">
          <h5>Connect With Us</h5>
          <div class="social-links">
            <a href="https://www.facebook.com/share/18p6QUDZgh/"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="https://www.instagram.com/vconnect2025"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-linkedin"></i></a>
          </div>
        </div>
      </div>
      <hr class="mt-4">
      <div class="text-center">
        <p>&copy; 2024 V-Connect. All rights reserved.</p>
      </div>
    </div>
  </footer>
  <script src="../config/firebaseConfig.js""></script>
   <script type="module">
  
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
    import { 
        getAuth, 
        createUserWithEmailAndPassword, 
        signInWithEmailAndPassword, 
        sendEmailVerification, 
        GoogleAuthProvider, 
        signInWithPopup 
    } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
    import { 
        getFirestore, 
        doc, 
        setDoc, 
        getDoc,
        collection, 
        addDoc 
    } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM Elements
    const elements = {
        signupForm: document.getElementById('signup-form'),
        loginForm: document.getElementById('login-form'),
        toggleForm: document.getElementById('toggle-form'),
        toggleToSignup: document.getElementById('toggle-to-signup'),
        googleSignupBtn: document.getElementById('google-signup'),
        googleLoginBtn: document.getElementById('google-login'),
        passwordInput: document.getElementById('password')
    };

    // Utility Functions
    const utils = {
        validateEmail: email => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email),
        validatePassword: password => ({
            length: password.length >= 8,
            uppercase: /[A-Z]/.test(password),
            lowercase: /[a-z]/.test(password),
            number: /[0-9]/.test(password),
            special: /[^A-Za-z0-9]/.test(password)
        }),
        showMessage: (form, message, type = 'danger') => {
            const existingAlert = form.querySelector('.alert');
            if (existingAlert) existingAlert.remove();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `alert alert-${type}`;
            messageDiv.textContent = message;
            form.insertBefore(messageDiv, form.firstChild);

            if (type === 'success') setTimeout(() => messageDiv.remove(), 5000);
        },
        togglePasswordVisibility: button => {
            const input = button.previousElementSibling;
            const icon = button.querySelector('i');
            input.type = input.type === 'password' ? 'text' : 'password';
            icon.className = `fas fa-eye${input.type === 'password' ? '' : '-slash'}`;
        },
        handleAuthError: error => {
            const errorMessages = {
                'auth/email-already-in-use': 'This email is already registered. Please login instead.',
                'auth/invalid-email': 'Invalid email address format.',
                'auth/weak-password': 'Password should be at least 6 characters.',
                'auth/user-disabled': 'This account has been disabled.',
                'auth/user-not-found': 'No account found with this email.',
                'auth/wrong-password': 'Incorrect password.'
            };
            return errorMessages[error.code] || `Error: ${error.message}`;
        }
    };

    // Initialize Form Display
    const showSignup = new URLSearchParams(window.location.search).get('signup') === 'true';
    if (showSignup) {
        elements.signupForm.style.display = 'block';
        elements.loginForm.style.display = 'none';
    }

    // Form Toggle Function
    const toggleForms = () => {
        const isLogin = elements.loginForm.style.display !== 'none';
        elements.loginForm.style.display = isLogin ? 'none' : 'block';
        elements.signupForm.style.display = isLogin ? 'block' : 'none';
    };

    // Event Listeners
    [elements.toggleForm, elements.toggleToSignup].forEach(el => 
        el.addEventListener('click', e => {
            e.preventDefault();
            toggleForms();
        })
    );

    // Password Requirements Validation
    elements.passwordInput.addEventListener('input', () => {
        const password = elements.passwordInput.value;
        Object.keys(utils.validatePassword(password)).forEach(requirement => {
            const element = document.querySelector(`[data-requirement="${requirement}"]`);
            const isValid = utils.validatePassword(password)[requirement];
            element.classList.toggle('valid-requirement', isValid);
            element.querySelector('i').className = isValid ? 'fas fa-check-circle' : 'fas fa-circle';
        });
    });

    // Password Toggle Visibility
    document.querySelectorAll('.toggle-password').forEach(button => {
        button.addEventListener('click', () => utils.togglePasswordVisibility(button));
    });

    // Sign Up Form Handler
    elements.signupForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = {
            name: document.getElementById('name').value.trim(),
            email: document.getElementById('email').value.trim(),
            password: document.getElementById('password').value,
            userType: document.getElementById('userType').value
        };

        // Validation
        if (!Object.values(formData).every(Boolean)) {
            utils.showMessage(elements.signupForm, "Please fill in all fields");
            return;
        }

        if (!utils.validateEmail(formData.email)) {
            utils.showMessage(elements.signupForm, "Please enter a valid email address");
            return;
        }

        const submitBtn = elements.signupForm.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';

        try {
            const userCredential = await createUserWithEmailAndPassword(auth, formData.email, formData.password);
            const user = userCredential.user;

            await sendEmailVerification(user);
            await setDoc(doc(db, 'users', user.uid), {
                uid: user.uid,
                ...formData,
                profileCompleted: false,
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString(),
                status: 'active'
            });

            // Store user info
            ['userType', 'name', 'email'].forEach(key => 
                localStorage.setItem(key, formData[key])
            );

            utils.showMessage(elements.signupForm, 
                "Account created successfully! Please verify your email before logging in.", 
                "success"
            );

            // Create welcome notification and activity log
            await Promise.all([
                addDoc(collection(db, 'notifications'), {
                    userId: user.uid,
                    type: 'welcome',
                    title: 'Welcome to V-Connect!',
                    message: `Welcome ${formData.name}! Thank you for joining our community.`,
                    read: false,
                    createdAt: new Date().toISOString()
                }),
                addDoc(collection(db, 'activities'), {
                    userId: user.uid,
                    type: 'signup',
                    details: `New ${formData.userType} account created`,
                    timestamp: new Date().toISOString()
                })
            ]);

            setTimeout(() => {
                elements.signupForm.reset();
                toggleForms();
                document.getElementById('login-email').value = formData.email;
            }, 1500);

        } catch (error) {
            console.error("Signup Error:", error);
            utils.showMessage(elements.signupForm, utils.handleAuthError(error));
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-user-plus me-2"></i> Create Account';
        }
    });

    // Login Form Handler
    elements.loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;

        if (!email || !password) {
            utils.showMessage(elements.loginForm, "Please fill all fields");
            return;
        }

        const submitBtn = elements.loginForm.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';

        try {
            const { user } = await signInWithEmailAndPassword(auth, email, password);

            if (!user.emailVerified) {
                throw new Error("Please verify your email before logging in.");
            }

            const userData = (await getDoc(doc(db, 'users', user.uid))).data();
            if (!userData) throw new Error("User profile not found.");

            localStorage.setItem('userType', userData.userType);
            localStorage.setItem('userName', userData.name);

            const redirectPath = userData.userType === 'volunteer' ? 
                '../volunteer/dashboard.html' : 
                '../organizer/organizerDashboard.html';

            utils.showMessage(elements.loginForm, "Login successful! Redirecting...", "success");
            setTimeout(() => window.location.href = redirectPath, 1000);

        } catch (error) {
            utils.showMessage(elements.loginForm, utils.handleAuthError(error));
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-sign-in-alt me-2"></i> Sign In';
        }
    });

    // Google Authentication
    const handleGoogleAuth = async (isSignup) => {
        try {
            const provider = new GoogleAuthProvider();
            const { user } = await signInWithPopup(auth, provider);
            
            utils.showMessage(
                isSignup ? elements.signupForm : elements.loginForm,
                `Google ${isSignup ? 'Sign-Up' : 'Login'} successful!`,
                "success"
            );

            setTimeout(() => {
                window.location.href = '../volunteer/dashboard.html';
            }, 1500);

        } catch (error) {
            console.error(`Google Auth Error:`, error);
            utils.showMessage(
                isSignup ? elements.signupForm : elements.loginForm,
                `Google ${isSignup ? 'Sign-Up' : 'Login'} failed. Please try again.`
            );
        }
    };

    elements.googleSignupBtn.addEventListener('click', () => handleGoogleAuth(true));
    elements.googleLoginBtn.addEventListener('click', () => handleGoogleAuth(false));

    // Forgot Password
    document.getElementById('forgot-password').addEventListener('click', e => {
        e.preventDefault();
        alert("Forgot password functionality will be implemented soon.");
    });
</script>

</body>
</html>